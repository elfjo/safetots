{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../node_modules/@babel/runtime/helpers/typeof.js","webpack:///./js/_legacy/drivers/tinymce.ts","webpack:///../node_modules/@babel/runtime/helpers/slicedToArray.js","webpack:///./js/_legacy/utils/editor.ts","webpack:///./js/_legacy/drivers/base.ts","webpack:///../node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack:///../node_modules/@babel/runtime/helpers/classCallCheck.js","webpack:///../node_modules/@babel/runtime/helpers/setPrototypeOf.js","webpack:///../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack:///../node_modules/@babel/runtime/helpers/iterableToArray.js","webpack:///../node_modules/@babel/runtime/helpers/createClass.js","webpack:///../node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack:///../node_modules/@babel/runtime/helpers/arrayWithHoles.js","webpack:///../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","webpack:///../node_modules/@babel/runtime/helpers/nonIterableRest.js","webpack:///../node_modules/@babel/runtime/helpers/assertThisInitialized.js","webpack:///../node_modules/@babel/runtime/helpers/getPrototypeOf.js","webpack:///../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","webpack:///../node_modules/@babel/runtime/helpers/inherits.js","webpack:///../node_modules/@babel/runtime/helpers/asyncToGenerator.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_typeof2","obj","iterator","constructor","_typeof","TinyMCEDriver","_this","_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_3___default","this","editorCitationObserver","MutationObserver","mutations","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","next","done","mutation","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","removedNodes","node","Element","classList","contains","_base__WEBPACK_IMPORTED_MODULE_9__","citationClass","dispatchEvent","CustomEvent","events","CITATION_DELETED","err","return","selectionCache","fresh","selection","bookmark","rng","document","createRange","message","editor","windowManager","alert","clusters","citationByIndex","kind","focus","doc","getDoc","oldElements","querySelectorAll","concat","footnoteId","bibliographyId","_arr","Array","from","_i","length","old","parentElement","removeChild","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_step3$value","_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_2___default","index","content","id","citation","getElementById","innerHTML","reflist","JSON","stringify","citationItems","map","dataset","footnote","insertContent","createInlineElement","classNames","outerHTML","composeFootnotes","Promise","resolve","reject","attempts","interval","setInterval","tinyMCE","clearInterval","Error","top","ABT","i18n","errors","tinymce_unavailable","editors","initialized","_this2","bindEvents","itemIds","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","item","elements","_arr2","_i2","element","options","bibliography","arguments","setStaticBibliography","setStandardBibliography","loading","setProgressState","_this3","on","assign","getBookmark","UNAVAILABLE","AVAILABLE","UNDO","addShortcut","ADD_REFERENCE","TOGGLE_PINNED","observe","getBody","childList","subtree","orderedFootnotes","_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default","entries","reduce","prev","_ref","_ref2","idx","getAttribute","note","createFootnoteSection","body","setCursorLocation","childNodes","moveToBookmark","bib","createBibliographyElement","items","staticBib","staticBibClass","citations","nodes","isFootnoteType","querySelector","refs","parse","citationID","ref","properties","noteIndex","_this4","startContainer","parentNode","compareDocumentPosition","Node","DOCUMENT_POSITION_PRECEDING","itemsPreceding","DOCUMENT_POSITION_FOLLOWING","itemsFollowing","getContent","format","arrayWithHoles","iterableToArrayLimit","nonIterableRest","arr","EditorEvents","editor_Editor","_bib$classList","headingElement","_ref$bib_heading","bib_heading","_ref$bib_heading_leve","bib_heading_level","_ref$bibliography","createElement","Editor","setAttribute","add","apply","toConsumableArray_default","remove","removeAttribute","warnings","warning","no_bib","textContent","appendChild","container","itemMeta","html","footnotes","_note$classList","heading","misc","_arr$_i","slicedToArray_default","itemNumber","itemContent","_a","_element$classList","_a$classNames","__rest","base_EditorDriver","window","_loading","arrayWithoutHoles","iterableToArray","nonIterableSpread","instance","Constructor","TypeError","_setPrototypeOf","setPrototypeOf","__proto__","isArray","arr2","iter","toString","_defineProperties","target","props","descriptor","configurable","writable","protoProps","staticProps","_n","_d","_e","_s","push","self","ReferenceError","_getPrototypeOf","getPrototypeOf","assertThisInitialized","subClass","superClass","asyncGeneratorStep","gen","_next","_throw","arg","info","error","then","fn","args"],"mappings":"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","file":"bundle/drivers/tinymce.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 133);\n","function _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","import { Citation, CitationKind, CitationResult, Locator } from 'citeproc';\nimport { Editor, TinyMCE } from 'tinymce';\n\nimport './tinymce.scss';\n\nimport EditorDriver, { RelativeCitationPositions } from './base';\n\ninterface SelectionCache {\n    bookmark: {\n        rng: Range;\n    };\n    fresh: boolean;\n    selection: string;\n}\n\ndeclare const tinyMCE: TinyMCE | undefined;\n\nexport default class TinyMCEDriver extends EditorDriver {\n    /**\n     * The TinyMCE editor instance\n     */\n    private editor!: Editor;\n\n    /**\n     * `MutationObserver` which watches and reacts to removals of individual\n     * citation nodes.\n     */\n    private editorCitationObserver = new MutationObserver(\n        (mutations): void => {\n            for (const mutation of mutations) {\n                for (const node of mutation.removedNodes) {\n                    if (\n                        node instanceof Element &&\n                        node.classList.contains(EditorDriver.citationClass)\n                    ) {\n                        dispatchEvent(\n                            new CustomEvent(\n                                EditorDriver.events.CITATION_DELETED,\n                            ),\n                        );\n                    }\n                }\n            }\n        },\n    );\n\n    /**\n     * Small helper that caches the most previous selection content and\n     * bookmark when the editor loses focus.\n     */\n    private selectionCache: SelectionCache = {\n        /**\n         * True if focus is currently outside of the editor. Otherwise a\n         * non-cached selection should be used\n         */\n        fresh: false,\n        /**\n         * Content currently selected (HTML)\n         */\n        selection: '',\n        bookmark: { rng: document.createRange() },\n    };\n\n    get citationIds(): string[] {\n        const citations = this.editor\n            .getDoc()\n            .querySelectorAll(\n                `*:not(.mce-offscreen-selection) > .${\n                    EditorDriver.citationClass\n                }`,\n            );\n        return [...citations].map(c => c.id);\n    }\n\n    get citationsByIndex(): Citation[] {\n        const doc = this.editor.getDoc();\n        const nodes = [\n            ...doc.querySelectorAll(`\n                *:not(.mce-offscreen-selection) >\n                    .${EditorDriver.citationClass}\n            `),\n        ];\n        const isFootnoteType =\n            doc.querySelector(`#${EditorDriver.footnoteId}`) !== null;\n\n        return nodes.reduce(\n            (prev, citation, index) => {\n                const reflist = citation.getAttribute('data-reflist');\n\n                if (!reflist) {\n                    return prev;\n                }\n\n                const refs: string[] = JSON.parse(reflist);\n\n                return [\n                    ...prev,\n                    {\n                        citationID: citation.id,\n                        citationItems: refs.map(ref => ({\n                            id: ref,\n                        })),\n                        properties: {\n                            index,\n                            noteIndex: isFootnoteType ? 1 : 0,\n                        },\n                    },\n                ];\n            },\n            <Citation[]>[],\n        );\n    }\n\n    get relativeCitationPositions(): RelativeCitationPositions {\n        const doc = this.editor.getDoc();\n        const bm = this.selectionCache.fresh\n            ? this.selectionCache.bookmark\n            : this.editor.selection.getBookmark(1);\n        const {\n            rng: { startContainer },\n        } = bm;\n        const citationNodes = [\n            ...doc.querySelectorAll(`\n                *:not(.mce-offscreen-selection) >\n                    .${EditorDriver.citationClass}\n            `),\n        ];\n\n        return citationNodes.reduce(\n            (prev, citation, i) => {\n                if (!citation.parentNode) {\n                    throw new Error('parentNode not defined for citation');\n                }\n\n                const position = startContainer.compareDocumentPosition(\n                    citation,\n                );\n\n                switch (position) {\n                    case Node.DOCUMENT_POSITION_PRECEDING:\n                        prev.itemsPreceding = [\n                            ...prev.itemsPreceding,\n                            [citation.id, i],\n                        ];\n                        break;\n                    case Node.DOCUMENT_POSITION_FOLLOWING:\n                        prev.itemsFollowing = [\n                            ...prev.itemsFollowing,\n                            [citation.id, i + 1],\n                        ];\n                        break;\n                    default:\n                        citation.parentElement!.removeChild(citation);\n                        this.editor.selection.moveToBookmark(\n                            this.selectionCache.bookmark,\n                        );\n                }\n                return prev;\n            },\n            {\n                itemsPreceding: <Locator>[],\n                itemsFollowing: <Locator>[],\n            },\n        );\n    }\n\n    get selection(): string {\n        return this.selectionCache.fresh\n            ? this.selectionCache.selection\n            : this.editor.selection.getContent({ format: 'html' });\n    }\n\n    alert(message: string): void {\n        this.editor.windowManager.alert(message);\n    }\n\n    composeCitations(\n        clusters: CitationResult[],\n        citationByIndex: Citation[],\n        kind: CitationKind,\n    ): void {\n        this.editor.focus();\n        const doc = this.editor.getDoc();\n        const oldElements = doc.querySelectorAll(`\n            #${EditorDriver.footnoteId},\n            #${EditorDriver.bibliographyId}\n        `);\n\n        for (const old of Array.from(oldElements)) {\n            if (old.parentElement) {\n                old.parentElement.removeChild(old);\n            }\n        }\n\n        for (const [index, content, id] of clusters) {\n            const citation = doc.getElementById(id);\n            const innerHTML = kind === 'note' ? `[${index + 1}]` : content;\n            const reflist = JSON.stringify(\n                citationByIndex[index].citationItems.map(c => c.id),\n            );\n\n            if (citation) {\n                citation.innerHTML = innerHTML;\n                citation.dataset.reflist = reflist;\n                citation.dataset.footnote =\n                    kind === 'note' ? content : undefined;\n            } else {\n                this.editor.insertContent(\n                    EditorDriver.createInlineElement({\n                        classNames: ['noselect', 'mceNonEditable'],\n                        footnote: kind === 'note' ? content : undefined,\n                        id,\n                        innerHTML,\n                        kind,\n                        reflist,\n                    }).outerHTML,\n                );\n            }\n        }\n\n        return kind === 'note' ? this.composeFootnotes() : void 0;\n    }\n\n    async init(): Promise<void> {\n        return new Promise<void>(\n            (resolve, reject): void => {\n                let attempts = 0;\n                let interval = setInterval(() => {\n                    if (tinyMCE === undefined) {\n                        attempts += 1;\n                        if (attempts === 10) {\n                            clearInterval(interval);\n                            return reject(\n                                new Error(\n                                    top.ABT.i18n.errors.tinymce_unavailable,\n                                ),\n                            );\n                        }\n                    } else {\n                        clearInterval(interval);\n                        if (\n                            tinyMCE.editors &&\n                            tinyMCE.editors.content &&\n                            tinyMCE.editors.content.initialized\n                        ) {\n                            this.editor = tinyMCE.editors.content;\n                            this.bindEvents();\n                            return resolve();\n                        }\n                        interval = setInterval(() => {\n                            if (\n                                tinyMCE.editors.content &&\n                                tinyMCE.editors.content.initialized\n                            ) {\n                                clearInterval(interval);\n                                this.editor = tinyMCE.editors.content;\n                                this.bindEvents();\n                                return resolve();\n                            }\n                        }, 200);\n                    }\n                }, 500);\n            },\n        );\n    }\n\n    removeItems(itemIds: string[]): void {\n        const doc = this.editor.getDoc();\n        for (const id of itemIds) {\n            const item = doc.getElementById(id);\n            if (item && item.parentElement) {\n                item.parentElement.removeChild(item);\n            }\n        }\n    }\n\n    reset(): void {\n        const elements = this.editor\n            .getDoc()\n            .querySelectorAll(\n                `#${EditorDriver.bibliographyId}, .${\n                    EditorDriver.citationClass\n                }`,\n            );\n        for (const element of Array.from(elements)) {\n            if (element.parentElement) {\n                element.parentElement.removeChild(element);\n            }\n        }\n        // Required to allow tinymce to consume changes\n        this.editor.insertContent('');\n    }\n\n    setBibliography(\n        options: ABT.DisplayOptions,\n        bibliography: ABT.Bibliography | boolean,\n        staticBib: boolean = false,\n    ): void {\n        return staticBib\n            ? this.setStaticBibliography(bibliography)\n            : this.setStandardBibliography(options, bibliography);\n    }\n\n    setLoadingState(loading?: boolean): void {\n        this.editor.setProgressState(loading || false);\n    }\n\n    protected bindEvents(): void {\n        this.editor.on('focusin', () => {\n            this.selectionCache = { ...this.selectionCache, fresh: false };\n        });\n        this.editor.on('focusout', () => {\n            this.selectionCache = {\n                fresh: true,\n                selection: this.selection,\n                bookmark: this.editor.selection.getBookmark(1),\n            };\n        });\n        this.editor.on('hide', () => {\n            dispatchEvent(new CustomEvent(EditorDriver.events.UNAVAILABLE));\n        });\n        this.editor.on('show', () => {\n            dispatchEvent(new CustomEvent(EditorDriver.events.AVAILABLE));\n        });\n        this.editor.on('Undo', () => {\n            dispatchEvent(new CustomEvent(EditorDriver.events.UNDO));\n        });\n        this.editor.addShortcut('meta+alt+r', 'Add Reference', () =>\n            dispatchEvent(new CustomEvent(EditorDriver.events.ADD_REFERENCE)),\n        );\n        this.editor.addShortcut('meta+alt+p', 'Pin Reference List', () =>\n            dispatchEvent(new CustomEvent(EditorDriver.events.TOGGLE_PINNED)),\n        );\n        this.editorCitationObserver.observe(this.editor.getBody(), {\n            childList: true,\n            subtree: true,\n        });\n    }\n\n    private composeFootnotes(): void {\n        const doc = this.editor.getDoc();\n        const orderedFootnotes = [\n            ...doc.querySelectorAll(`.${EditorDriver.citationClass}`).entries(),\n        ].reduce(\n            (prev, [idx, item]) => {\n                item.innerHTML = `[${idx + 1}]`;\n                const footnote = item.getAttribute('data-footnote');\n                return footnote ? [...prev, footnote] : prev;\n            },\n            <string[]>[],\n        );\n\n        if (orderedFootnotes.length === 0) {\n            return;\n        }\n\n        const bookmark = this.editor.selection.getBookmark();\n\n        const note = EditorDriver.createFootnoteSection(orderedFootnotes, [\n            'noselect',\n            'mceNonEditable',\n        ]);\n\n        const body = this.editor.getBody();\n        this.editor.selection.setCursorLocation(body, body.childNodes.length);\n        this.editor.insertContent(note.outerHTML);\n        this.editor.selection.moveToBookmark(bookmark);\n    }\n\n    private setStandardBibliography(\n        options: ABT.DisplayOptions,\n        bibliography: ABT.Bibliography | boolean,\n    ): void {\n        if (typeof bibliography === 'boolean' || bibliography.length === 0) {\n            return;\n        }\n\n        const bib = EditorDriver.createBibliographyElement(\n            options,\n            bibliography,\n            ['noselect', 'mceNonEditable'],\n        );\n        const bookmark = this.editor.selection.getBookmark();\n\n        const body = this.editor.getBody();\n        this.editor.selection.setCursorLocation(body, body.childNodes.length);\n        this.editor.insertContent(bib.outerHTML);\n        this.editor.selection.moveToBookmark(bookmark);\n    }\n\n    private setStaticBibliography(\n        bibliography: ABT.Bibliography | boolean,\n    ): void {\n        const items: ABT.Bibliography =\n            typeof bibliography === 'boolean' ? [] : bibliography;\n        const staticBib = EditorDriver.createBibliographyElement({}, items, [\n            `${EditorDriver.staticBibClass}`,\n            'noselect',\n            'mceNonEditable',\n        ]);\n        if (this.selectionCache.fresh) {\n            this.editor.selection.moveToBookmark(this.selectionCache.bookmark);\n        }\n        this.editor.insertContent(staticBib.outerHTML);\n    }\n}\n","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","// tslint:disable no-stateless-class\nimport { CitationKind } from 'citeproc';\n\ninterface InlineElementOptions {\n    classNames?: string[];\n    footnote?: string;\n    id: string;\n    innerHTML: string;\n    kind: CitationKind;\n    reflist: string;\n}\n\nenum EditorEvents {\n    /**\n     * Bind and emit this if the editor supports keyboard shortcuts. Keyboard\n     * shortcut for this should be cmd/ctrl+alt+r\n     */\n    ADD_REFERENCE = 'ADD_REFERENCE',\n    /**\n     * Emit this any time the editor becomes available again after being\n     * unavailable (excluding the initial initialization).\n     */\n    AVAILABLE = 'EDITOR_AVAILABLE',\n    /**\n     * Emit this when user manually deletes one or more inline citations using\n     * the keyboard.\n     */\n    CITATION_DELETED = 'CITATION_DELETED',\n    /**\n     * Bind and emit to this if the editor supports keyboard shortcuts.\n     * Keyboard shortcut for this should be cmd/ctrl+alt+p\n     */\n    TOGGLE_PINNED = 'TOGGLE_PINNED',\n    /**\n     * Emit this any time the editor goes unavailable or becomes hidden.\n     */\n    UNAVAILABLE = 'EDITOR_UNAVAILABLE',\n    /**\n     * Emit this any time the user performs an \"undo\" in the editor.\n     */\n    UNDO = 'UNDO',\n}\n\nexport default abstract class Editor {\n    static readonly events = EditorEvents;\n\n    static readonly bibliographyId = 'abt-bibliography';\n    static readonly citationClass = 'abt-citation';\n    static readonly footnoteId = 'abt-footnote';\n    static readonly staticBibClass = 'abt-static-bib';\n\n    static createBibliographyElement(\n        {\n            bib_heading = '',\n            bib_heading_level = 'h3',\n            bibliography = 'fixed',\n        }: Partial<ABT.DisplayOptions>,\n        items: ABT.Bibliography,\n        classNames: string[] = [],\n    ): HTMLDivElement {\n        const bib = document.createElement('div');\n        bib.id = Editor.bibliographyId;\n        bib.setAttribute(\n            'data-reflist',\n            JSON.stringify(items.map(({ id }) => id)),\n        );\n        bib.classList.add(Editor.bibliographyId, ...classNames);\n\n        if (bib.classList.contains(Editor.staticBibClass)) {\n            bib.classList.remove(Editor.bibliographyId);\n            bib.removeAttribute('id');\n            // Occurs only when attempting to insert a static list when the\n            // user's selected citation type doesn't define a bibliography.\n            if (items.length === 0) {\n                const { warnings } = top.ABT.i18n.errors;\n                bib.innerHTML = `<strong>${warnings.warning}:</strong> ${\n                    warnings.no_bib\n                }.`;\n                return bib;\n            }\n        }\n\n        if (bib_heading) {\n            let headingElement;\n            if (bibliography === 'toggle') {\n                headingElement = document.createElement('button');\n                headingElement.classList.add(\n                    `${Editor.bibliographyId}__heading`,\n                    `${Editor.bibliographyId}__heading_toggle`,\n                );\n                headingElement.setAttribute('aria-expanded', 'false');\n                headingElement.setAttribute(\n                    'aria-controls',\n                    `${this.bibliographyId}__container`,\n                );\n                headingElement.setAttribute(\n                    'data-heading-level',\n                    bib_heading_level,\n                );\n            } else {\n                headingElement = document.createElement(bib_heading_level);\n                headingElement.classList.add(\n                    `${Editor.bibliographyId}__heading`,\n                );\n            }\n            headingElement.textContent = bib_heading;\n            bib.appendChild(headingElement);\n        }\n\n        const container = document.createElement('div');\n        container.id = `${this.bibliographyId}__container`;\n        container.classList.add(`${this.bibliographyId}__container`);\n        bib.appendChild(container);\n\n        for (const itemMeta of items) {\n            const item = document.createElement('div');\n            item.id = itemMeta.id;\n            item.innerHTML = itemMeta.html;\n            container.appendChild(item);\n        }\n\n        return bib;\n    }\n\n    static createFootnoteSection(\n        footnotes: string[],\n        classNames: string[] = [],\n    ): HTMLDivElement {\n        const note = document.createElement('div');\n        note.id = Editor.footnoteId;\n        note.classList.add(Editor.footnoteId, ...classNames);\n\n        const heading = document.createElement('div');\n        heading.classList.add(`${Editor.footnoteId}__heading`);\n        heading.textContent = top.ABT.i18n.misc.footnotes;\n\n        note.appendChild(heading);\n\n        for (const [index, footnote] of Array.from(footnotes.entries())) {\n            const item = document.createElement('div');\n            item.classList.add(`${Editor.footnoteId}__item`);\n\n            const itemNumber = document.createElement('span');\n            itemNumber.classList.add(`${Editor.footnoteId}__number`);\n            itemNumber.textContent = `[${index + 1}]`;\n\n            const itemContent = document.createElement('span');\n            itemContent.classList.add(`${Editor.footnoteId}__content`);\n            itemContent.innerHTML = footnote;\n\n            item.appendChild(itemNumber);\n            item.appendChild(itemContent);\n\n            note.appendChild(item);\n        }\n\n        return note;\n    }\n\n    static createInlineElement({\n        classNames = [],\n        ...options\n    }: InlineElementOptions): HTMLSpanElement {\n        const { id, innerHTML, reflist } = options;\n        const element = document.createElement('span');\n        element.id = id;\n        element.classList.add(Editor.citationClass, ...classNames);\n        element.innerHTML = innerHTML;\n        element.setAttribute('data-reflist', reflist);\n        if (options.kind === 'note') {\n            element.setAttribute('data-footnote', options.footnote!);\n        }\n        return element;\n    }\n}\n","import { Citation, CitationKind, CitationResult, Locator } from 'citeproc';\n\nimport Editor from '_legacy/utils/editor';\n\nexport type EditorDriverConstructor = new () => EditorDriver;\n\nexport interface RelativeCitationPositions {\n    itemsPreceding: Locator;\n    itemsFollowing: Locator;\n}\n\n/**\n * Base class from which all editor drivers must be derived\n */\nexport default abstract class EditorDriver extends Editor {\n    /**\n     * Retrieve an array of every HTMLElement ID for all citations currently\n     * existing in the editor.\n     */\n    abstract get citationIds(): string[];\n\n    /**\n     * Retrieve a `Citeproc.CitationByIndex` object describing the order and\n     * contents of all citations existing in the document.\n     */\n    abstract get citationsByIndex(): Citation[];\n\n    /**\n     * Returns a `Citeproc.RelativeCitationPositions` describing citations\n     * located before and after the current cursor location.\n     */\n    abstract get relativeCitationPositions(): RelativeCitationPositions;\n\n    /**\n     * Retrive the currently selected content in the editor as a raw HTML string.\n     */\n    abstract get selection(): string;\n\n    /**\n     * If the editor has some form of alert or notifications system, override\n     * this so the native notifications are used.\n     * @param message Message to be alerted to the user.\n     */\n    alert(message: string): void {\n        window.alert(message);\n    }\n\n    /**\n     * Responsible for taking the data generated by the citation processor and\n     * composing the citations in the editor.\n     * @param clusters Array of `Citeproc.CitationCluster`\n     * @param citationByIndex Array of `Citeproc.Citation` ordered by position in document\n     * @param kind One of `note` or `in-text`\n     */\n    abstract composeCitations(\n        clusters: CitationResult[],\n        citationByIndex: Citation[],\n        kind: CitationKind,\n    ): void;\n\n    /**\n     * Called when the window is loaded. Should resolve when the editor is\n     * available and ready.\n     */\n    abstract async init(): Promise<void>;\n\n    /**\n     * Responsible for finding and removing elements from the editor that have\n     * the given HTML Element IDs.\n     * @param idList Array of HTML element IDs to remove from the document\n     */\n    abstract removeItems(idList: string[]): void;\n\n    /**\n     * Find and remove all citations, footnotes, and bibliographies. Static\n     * bibliographies should be maintained.\n     */\n    abstract reset(): void;\n\n    /**\n     * Receives a bibliography array and options as input and composes and\n     * inserts a bibliography in the editor.\n     * @param options Object containing the user's bibliography options\n     * @param bibliography Either an array of ABT.Bibliograhy or `false` if the\n     * user's current citation style does not support bibliographies\n     * @param staticBib Is the bibliography a static biblography? (This should\n     * default to false)\n     */\n    abstract setBibliography(\n        options: ABT.DisplayOptions,\n        bibliography: ABT.Bibliography | boolean,\n        staticBib?: boolean,\n    ): void;\n\n    /**\n     * If the editor supports a 'loading' state which shows a spinner or some\n     * progress indicator, this should be implemented.\n     *   - If `true` is passed as an arg, the editor's state should be loading.\n     *   - If `false` is passed as an arg, the editor's state should be not loading.\n     *   - If no args are passed, the editor's loading state should be toggled to\n     *   the opposite of what it currently is.\n     * @param _loading Optional argument to explicitly set the loading state\n     */\n    setLoadingState(_loading?: boolean): void {\n        return;\n    }\n\n    /**\n     * Should be used for binding all `EditorEvents` to the appropriate\n     * handlers for the editor. Must be called internally (ideally should be\n     * done directly before promise resolution in the `init()` method).\n     * @emits Editor.EditorEvents\n     */\n    protected abstract bindEvents(): void;\n}\n","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nmodule.exports = _nonIterableSpread;","function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","function _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nmodule.exports = _nonIterableRest;","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","var _typeof = require(\"../helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;"],"sourceRoot":""}